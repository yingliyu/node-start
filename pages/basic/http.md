# Nodejs åŸºç¡€â€”â€”http æ¨¡å—

<!-- 127.0.0.1 -->

## å‰è¨€

ä»¥å‰æ€»æ˜¯å¯¹å…¨æ ˆå—¤ä¹‹ä»¥é¼»ï¼Œè§‰å¾—åšå‰ç«¯å°±å­¦å¥½å‰ç«¯å°±å¯ä»¥äº†ï¼Œæ¯•ç«Ÿæœ¯ä¸šæœ‰ä¸“æ”»ï¼Œå†µä¸”å‰ç«¯çš„å†…å®¹ä¹Ÿå¾ˆå¤šè€Œä¸”æ—¥æ–°æœˆå¼‚ï¼Œä½†æ˜¯ä»Šå¤©æˆ‘çš„æƒ³æ³•è¢«é¢ è¦†äº†ï¼Œå˜å¾—é’çäºå…¨æ ˆã€‚å¯èƒ½æ˜¯ä¸€æ¬¡æ¬¡ä¾èµ–äºåç«¯è¿‡äºæŸæ‰‹æŸè„šï¼Œä¸èƒ½è‡ªç”±æŠŠè‡ªå·±çš„æƒ³æ³•å˜æˆç°å®/äº§å“ï¼Œé‚£ä¹ˆå°±ç°åœ¨ä»å­¦ä¹  Nodejs å¼€å§‹å§ï¼Œå†å‡ºå‘ï¼ğŸ’ª

Node.js å¼€å‘çš„ç›®çš„å°±æ˜¯ä¸ºäº†ç”¨ JavaScript ç¼–å†™ Web æœåŠ¡å™¨ç¨‹åºï¼ŒHTTP æ¨¡å—æ˜¯ JS ç¼–å†™ Web æœåŠ¡å™¨ç¨‹åºçš„æ ¸å¿ƒæ¨¡å—ã€‚æ­£æ˜¯å¦‚æ­¤ï¼Œç›¸ä¿¡å¤§éƒ¨åˆ†å‰ç«¯ er å·²ç»æŒæ¡äº† js å‰ç«¯çš„å¼€å‘ï¼Œé‚£ä¹ˆå†å­¦ä¼šå¦‚ä½•å°† js åº”ç”¨åœ¨åç«¯å¼€å‘ï¼Œé‚£ä½ å°±æ˜¯åå‰¯å…¶å®çš„å…¨æ ˆäº†ã€‚

## http ç›¸å…³æ¦‚å¿µ

http æ¨¡å—æ˜¯ Nodejs å®˜æ–¹æä¾›çš„ç”¨æ¥åˆ›å»º web æœåŠ¡å™¨çš„æ¨¡å—ã€‚é€šè¿‡ http æ¨¡å—æä¾›çš„ http.createServer()æ–¹æ³•å°±èƒ½æ–¹ä¾¿çš„æŠŠä¸€å°æ™®é€šçš„ç”µè„‘å˜æˆä¸€å° web æœåŠ¡å™¨ï¼Œä»è€Œå¯¹å¤–æä¾› web èµ„æºæœåŠ¡ã€‚å¯ä»¥ä½¿ç”¨`phpstudy`è¿›è¡Œå¼€å‘è°ƒè¯•ã€‚

### IP

æˆ‘ä»¬çŸ¥é“ IPï¼ˆInternet Protocol Addressï¼‰åœ°å€æŒ‡äº’è”ç½‘åè®®åœ°å€ï¼Œå°±æ˜¯äº’è”ç½‘ä¸Šæ¯å°è®¡ç®—æœºçš„å”¯ä¸€åœ°å€ï¼Œå› æ­¤ IP åœ°å€å…·æœ‰å”¯ä¸€æ€§ã€‚ç”µè„‘å’Œ IPï¼Œç›¸å½“äºæ‰‹æœºå’Œæ‰‹æœºå·ï¼Œåªæœ‰åœ¨çŸ¥é“å¯¹æ–¹ IP åœ°å€çš„å‰æä¸‹æ‰èƒ½ä¸å¯¹åº”çš„ç”µè„‘ä¹‹é—´è¿›è¡Œé€šä¿¡ã€‚

> äº’è”ç½‘ä¸­æ¯å° web æœåŠ¡å™¨éƒ½æœ‰è‡ªå·±çš„ IP åœ°å€ã€‚

### åŸŸå

> åŸŸåï¼ˆDomain Nameï¼‰æ˜¯ç”±ä¸€ä¸²ç”¨ç‚¹åˆ†éš”çš„åå­—ç»„æˆçš„ Internet ä¸ŠæŸä¸€å°è®¡ç®—æœºæˆ–è®¡ç®—æœºç»„çš„åç§°ï¼Œç”¨äºåœ¨æ•°æ®ä¼ è¾“æ—¶å¯¹è®¡ç®—æœºçš„å®šä½æ ‡è¯†ï¼ˆæœ‰æ—¶ä¹ŸæŒ‡åœ°ç†ä½ç½®ï¼‰ã€‚

å°½ç®¡ IP åœ°å€èƒ½å¤Ÿå”¯ä¸€åœ°æ ‡è®°ç½‘ç»œä¸Šçš„è®¡ç®—æœºï¼Œä½†ç”±äº IP åœ°å€é‡‡ç”¨äº†æ•°å­—åŒ–çš„å½¢å¼ï¼Œä¸æ–¹ä¾¿è®°å¿†å¹¶ä¸”ä¸èƒ½æ˜¾ç¤ºåœ°å€ç»„ç»‡çš„åç§°å’Œæ€§è´¨ç­‰ç¼ºç‚¹ï¼Œäººä»¬è®¾è®¡å‡ºäº†åŸŸåï¼ŒIP åœ°å€å’ŒåŸŸåå­˜åœ¨å¯¹åº”å…³ç³»ï¼Œé€šè¿‡åŸŸåç³»ç»Ÿï¼ˆDNSï¼ŒDomain Name Systemï¼‰æ¥å°†åŸŸåå’Œ IP åœ°å€ç›¸äº’æ˜ å°„ï¼Œä½¿ç”¨è€…åªéœ€é€šè¿‡å¥½è®°å¾—åŸŸåæ›´æ–¹ä¾¿åœ°è®¿é—®äº’è”ç½‘ï¼Œå¯¹åº”å¾—è½¬æ¢å·¥ä½œç”± DNS å®ç°ã€‚

åŸŸåç³»ç»Ÿå°±æ˜¯æä¾› IP åœ°å€å’ŒåŸŸåä¹‹é—´è½¬æ¢æœåŠ¡çš„æœåŠ¡å™¨ã€‚

ä½¿ç”¨ phpstudy Apache æœåŠ¡å™¨å¼€å‘æµ‹è¯•æœŸé—´ï¼Œ127.0.0.1 å¯¹åº”çš„åŸŸåæ˜¯ localhostï¼Œå®ƒä»¬éƒ½ä»£è¡¨è‡ªå·±çš„ç”µè„‘ã€‚

### ç«¯å£å·

åœ¨ä¸€å°ç”µè„‘ä¸­å¯è¿è¡Œæˆç™¾ä¸Šåƒä¸ª web æœåŠ¡ï¼Œæ¯ä¸ª web æœåŠ¡éƒ½å¯¹åº”ä¸€ä¸ªå”¯ä¸€çš„ç«¯å£å·ã€‚å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„ç½‘ç»œè¯·æ±‚é€šè¿‡ç«¯å£å·å¯ä»¥è¢«å‡†ç¡®çš„äº¤ç»™å¯¹åº”çš„ web æœåŠ¡å™¨è¿›è¡Œå¤„ç†ã€‚
ä¹Ÿå°±æ˜¯è¯´ï¼Œip åœ°å€ä»£è¡¨äº†æœåŠ¡å™¨çš„å…·ä½“åœ°å€ï¼Œç«¯å£å·ä»£è¡¨äº†æœåŠ¡å™¨ä¸­æ‰€æä¾›çš„æœåŠ¡ã€‚

åŒä¸€å°æœåŠ¡å™¨ï¼Œä¸€ä¸ªç«¯å£å·åªèƒ½å¯¹åº”ä¸€ä¸ª web æœåŠ¡ã€‚

## æ­å»º Http æœåŠ¡å™¨

æ­å»º Http æœåŠ¡å™¨çš„åŸºæœ¬æ­¥éª¤ï¼š

1. å¯¼å…¥ `http` æ¨¡å—
2. åˆ›å»º web æœåŠ¡å™¨å®ä¾‹
3. ä¸ºæœåŠ¡å™¨å®ä¾‹ç»‘å®š `request` äº‹ä»¶ï¼Œç›‘å¬å®¢æˆ·ç«¯çš„è¯·æ±‚
4. å¯åŠ¨æœåŠ¡å™¨

> è¯¥æ¨¡å—æä¾›äº†ä¸€äº›å±æ€§ã€æ–¹æ³•ã€ä»¥åŠç±»ã€‚

```js
// 1. å¯¼å…¥ httpæ¨¡å—
const http = require('http')
// 2. åˆ›å»º web æœåŠ¡å™¨å®ä¾‹
const server = http.createServer()
// 3. ä¸ºæœåŠ¡å™¨å®ä¾‹ç»‘å®šrequestäº‹ä»¶ï¼Œç›‘å¬å®¢æˆ·ç«¯çš„è¯·æ±‚
server.on('request', (req, res) => {
  console.log('Someone visit our web server.')
})
// 4. å¯åŠ¨æœåŠ¡å™¨
server.listen(8080, () => {
  console.log('Server running at http://localhost:8080')
})
```

åœ¨å‘½ä»¤è¡Œè¿è¡Œ`node ./http/server.js`ï¼Œç„¶ååœ¨æµè§ˆå™¨ä¸­è¾“å…¥`http://localhost:8080`ã€`http://localhost:8080/home.html`

```js
$ node ./http/demo.js
Server running at http://localhost:8080
Someone visit our web server.
Your request url is /, request method is GET
Your request url is /home.html, request method is GET
Someone visit our web server.
```

> è¦å¼€å‘ HTTP æœåŠ¡å™¨ç¨‹åºï¼Œä»å¤´å¤„ç† TCP è¿æ¥ï¼Œè§£æ HTTP æ˜¯ä¸ç°å®çš„ã€‚è¿™äº›å·¥ä½œå®é™…ä¸Šå·²ç»ç”± Node.js è‡ªå¸¦çš„ http æ¨¡å—å®Œæˆäº†ã€‚åº”ç”¨ç¨‹åºå¹¶ä¸ç›´æ¥å’Œ HTTP åè®®æ‰“äº¤é“ï¼Œè€Œæ˜¯æ“ä½œ http æ¨¡å—æä¾›çš„ request å’Œ response å¯¹è±¡ã€‚

## req è¯·æ±‚å¯¹è±¡

æœåŠ¡å™¨æ¥æ”¶åˆ°å®¢æˆ·ç«¯çš„è¯·æ±‚å°±ä¼šè°ƒç”¨ server.on()ä¸ºæœåŠ¡å™¨ç»‘å®š req äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œé€šè¿‡ req å¯ä»¥è®¿é—®ä¸å®¢æˆ·ç«¯ç›¸å…³çš„æ•°æ®æˆ–å±æ€§ã€‚

- req æ˜¯è¯·æ±‚å¯¹è±¡ï¼ŒåŒ…å«äº†ä¸å®¢æˆ·ç«¯ç›¸å…³çš„æ•°æ®å’Œå±æ€§ï¼›
- req.url æ˜¯å®¢æˆ·ç«¯è¯·æ±‚çš„ URL åœ°å€ï¼›
- req.method æ˜¯å®¢æˆ·ç«¯è¯·æ±‚çš„ method ç±»å‹ï¼Œä¾‹å¦‚ GETã€POST ç­‰ç­‰ï¼›

## res å“åº”å¯¹è±¡

åœ¨æœåŠ¡å™¨çš„ request äº‹ä»¶å¤„ç†å‡½æ•°ä¸­ï¼Œå¯é€šè¿‡ res è®¿é—®ä¸æœåŠ¡å™¨ç›¸å…³çš„æ•°æ®æˆ–å±æ€§ã€‚

## æ–¹æ³•

### http.createServer()

è¿”å› http.Server ç±»çš„æ–°å®ä¾‹

### http.request()

å‘é€ Http è¯·æ±‚åˆ°æœåŠ¡å™¨ï¼Œå¹¶åˆ›å»º http.ClientRequest ç±»çš„å®ä¾‹ã€‚

### server.on()

æœåŠ¡å™¨æ¥æ”¶åˆ°å®¢æˆ·ç«¯çš„è¯·æ±‚å°±ä¼šè°ƒç”¨ server.on()æ–¹æ³•

### server.listen()

å¯åŠ¨ HTTP æœåŠ¡å™¨ç›‘å¬è¿æ¥ã€‚

### res.setHeader()

res.setHeader(name,value)

- name <string>
- value <any>
  è¿”å›: <http.ServerResponse>
  è¿”å›å“åº”å¯¹è±¡ã€‚

è°ƒç”¨ res.setHeader()æ–¹æ³•è®¾ç½® Content-Type å“åº”å¤´è§£å†³ä¸­æ–‡ä¹±ç é—®é¢˜

```js
res.setHeader('Content-Type', 'text/html;charset=utf-8')
```

### res.end()

è°ƒç”¨ res.end()æ–¹æ³•å°†å†…å®¹å“åº”ç»™å®¢æˆ·ç«¯ï¼Œå¹¶ç»“æŸæ­¤æ¬¡è¯·æ±‚çš„å¤„ç†è¿‡ç¨‹ã€‚

## æ­å»ºä¸€ä¸ªæ–‡ä»¶æœåŠ¡å™¨

http æ¨¡å—ä¸»è¦ç”¨äºæ­å»º HTTP æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ã€‚

### åˆ›å»º Web æœåŠ¡å™¨:

```js
// server.js
const http = require('http')
const fs = require('fs')
const path = require('path')

// åˆ›å»ºæœåŠ¡å™¨
http
  .createServer((request, response) => {
    // è§£æè¯·æ±‚ï¼ŒåŒ…æ‹¬æ–‡ä»¶å
    const url = request.url
    console.log('=====', url)

    const fpath = path.join(__dirname, url)
    // è¾“å‡ºè¯·æ±‚çš„æ–‡ä»¶å
    console.log('Request for ' + url + ' received.')

    // ä»æ–‡ä»¶ç³»ç»Ÿä¸­è¯»å–è¯·æ±‚çš„æ–‡ä»¶å†…å®¹
    fs.readFile(fpath, (err, data) => {
      if (err) {
        console.log(err)
        // HTTP çŠ¶æ€ç : 404 : NOT FOUND
        // Content Type: text/html
        response.writeHead(404, { 'Content-Type': 'text/html' })
        return response.end('404 Not Found!')
      }
      // HTTP çŠ¶æ€ç : 200 : OK
      // Content Type: text/html
      response.writeHead(200, { 'Content-Type': 'text/html' })

      // å“åº”æ–‡ä»¶å†…å®¹
      response.write(data.toString())

      //  å‘é€å“åº”æ•°æ®
      response.end()
    })
  })
  .listen(8080)

// æ§åˆ¶å°ä¼šè¾“å‡ºä»¥ä¸‹ä¿¡æ¯
console.log('Server running at http://localhost:8080/')
```

åœ¨åŒçº§ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª index.html æ–‡ä»¶

```html
<html>
  <head>
    <meta charset="utf-8" />
    <title>Nodejs Http</title>
  </head>
  <body>
    <h1>æˆ‘çš„ç¬¬ä¸€ä¸ªæ ‡é¢˜</h1>
    <p>æˆ‘çš„ç¬¬ä¸€ä¸ªæ®µè½ã€‚</p>
  </body>
</html>
```

å‘½ä»¤è¡Œæ‰§è¡Œï¼š`node ./http/server.js`ï¼Œç»ˆç«¯è¾“å‡ºï¼š

```bash
Server running at http://localhost:8080/
Request for home.html received.
```

åœ¨æµè§ˆå™¨ä¸­è®¿é—® http://localhost:8080/index.html

### åˆ›å»º Web å®¢æˆ·ç«¯:

```js
const http = require('http')

const options = {
  host: 'localhost',
  port: '8080',
  path: '/index.html',
}

// å¤„ç†å“åº”çš„å›è°ƒå‡½æ•°
const callback = (res) => {
  let body = ''
  res.on('data', (data) => {
    body += data
  })
  res.on('end', () => {
    console.log('æ•°æ®æ¥æ”¶å®Œæˆ...', body)
  })
}
const req = http.request(options, callback)
req.end()
```

å‘½ä»¤è¡Œæ‰§è¡Œï¼š`node ./http/client.js`ï¼Œç»ˆç«¯è¾“å‡ºï¼š

```bash
æ•°æ®æ¥æ”¶å®Œæˆ... <html>
  <head>
    <meta charset="utf-8" />
    <title>Nodejs Http</title>
  </head>
  <body>
    <h1>æˆ‘çš„ç¬¬ä¸€ä¸ªæ ‡é¢˜</h1>
    <p>æˆ‘çš„ç¬¬ä¸€ä¸ªæ®µè½ã€‚</p>
  </body>
</html>
```

## æœ€å

æ›´å¤š API å‚è€ƒï¼š[Nodejs å®˜æ–¹](http://nodejs.cn/learn/the-nodejs-http-module)ã€[Nodejs æ•™ç¨‹](https://www.runoob.com/nodejs/nodejs-web-module.html)

> æ–‡ç« æœ‰è¯¯è§£çš„åœ°æ–¹ï¼Œæ¬¢è¿æŒ‡å‡ºï¼Œå°†åœ¨ç¬¬ä¸€æ—¶é—´æ”¹æ­£ï¼Œæœ‰æ›´å¥½çš„å®ç°æ–¹å¼å¸Œæœ›ç•™ä¸‹ä½ çš„è¯„è®º
